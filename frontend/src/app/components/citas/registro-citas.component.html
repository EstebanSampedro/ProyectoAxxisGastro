<app-main-header></app-main-header>
<app-nav-bar></app-nav-bar>
  <div class="date-section">
    <label for="fecha">Fecha:</label>
    <input
      type="date"
      id="fecha"
      [(ngModel)]="selectedDate"
      (change)="onDateChange()"
    />
    <span class="formatted-date">{{ formattedDate }}</span>
    <button (click)="cargarCitas()">Buscar</button>
  </div>
  
  <div class="observaciones-section">
    <label for="observaciones">OBSERVACIONES:</label>
    <textarea
      id="observaciones"
      rows="2"
      [(ngModel)]="observaciones"
    ></textarea>
    <button (click)="guardarObservaciones()">Guardar</button>
  </div>
<!-- Tabla de Citas -->
<table class="citas-table">
  <thead>
    <tr>
      <th>HORA</th>
      <th>M√âDICO</th>
      <th>PACIENTE</th>
      <th>EDAD</th>
      <th>TEL√âFONO</th>
      <th>PROCEDIMIENTO</th>
      <th>IMAGEN</th>
      <th>SOLICITADO</th>
      <th>INSTITUCI√ìN</th>
      <th>SEGURO</th>
      <th>OBSERVACIONES</th>
      <th>COLOR</th>
      <th>CONFIR.</th>
      <th>RESP.</th>
      <th>OPCIONES</th>
    </tr>
  </thead>
  <tbody cdkDropList (cdkDropListDropped)="drop($event)">
    <tr *ngFor="let cita of citas" 
        cdkDrag 
        [cdkDragData]="cita" 
        [ngStyle]="{ 'background-color': cita.colorCita || '' }">
      
      <td>{{ cita.hora }}</td>

      <ng-container *ngIf="editingCitaId === cita.idCita; else modoLectura">
        <td><input type="text" [(ngModel)]="newCitaData.medico" placeholder="M√©dico" /></td>
        <td><input type="text" [(ngModel)]="newCitaData.paciente" placeholder="Paciente" /></td>
        <td><input type="number" [(ngModel)]="newCitaData.edad" placeholder="Edad" /></td>
        <td><input type="text" [(ngModel)]="newCitaData.telefono" placeholder="Tel√©fono" /></td>
        <td><input type="text" [(ngModel)]="newCitaData.procedimiento" placeholder="Procedimiento" /></td>
        <td><input type="file" (change)="subirImagen($event)" /></td>
        <td><input type="text" [(ngModel)]="newCitaData.solicitado" placeholder="Solicitado" /></td>
        <td><input type="text" [(ngModel)]="newCitaData.institucion" placeholder="Instituci√≥n" /></td>
        <td><input type="text" [(ngModel)]="newCitaData.seguro" placeholder="Seguro" /></td>
        <td><input type="text" [(ngModel)]="newCitaData.observaciones" placeholder="Observaciones" /></td>
        <td>
          <select [(ngModel)]="newCitaData.colorCita">
            <option value="#FFFFFF">Ninguno</option>
            <option value="#ffff00">Amarillo</option>
            <option value="#ff0000">Rojo</option>
            <option value="#0000ff">Azul</option>
            <option value="#FEBB02">Naranja</option>
            <option value="#00ff00">Verde</option>
            <option value="#8080c0">Gris</option>
          </select>
        </td>
        <td><input type="checkbox" [(ngModel)]="newCitaData.confirmado" /></td>
        <td><input type="text" [(ngModel)]="newCitaData.responsable" /></td>
        <td>
          <div class="horizontal-btns">
            <button (click)="guardarEdicion()">Guardar</button>
            <button (click)="cancelarEdicion()">Cancelar</button>
          </div>
        </td>
      </ng-container>

      <ng-template #modoLectura>
        <td>{{ cita.medico }}</td>
        <td>{{ cita.paciente }}</td>
        <td>{{ cita.edad }}</td>
        <td>{{ cita.telefono }}</td>
        <td>{{ cita.procedimiento }}</td>
        <td><img [src]="cita.imagenUrl" alt="Imagen" class="imagen-cita"></td>
        <td>{{ cita.solicitado }}</td>
        <td>{{ cita.institucion }}</td>
        <td>{{ cita.seguro }}</td>
        <td>{{ cita.observaciones }}</td>
        <td>{{ colorNames[cita.colorCita] || cita.colorCita }}</td>
        <td>{{ cita.confirmado ? 'S√≠' : 'No' }}</td>
        <td>{{ cita.responsable }}</td>
        <td>
          <div class="horizontal-btns">
            <button (click)="enviarWhatsApp(cita)">üìû</button>
            <button (click)="confirmarCita(cita)">‚úî</button>
            <button (click)="editarCita(cita)">‚úèÔ∏è</button>
            <button (click)="eliminarCita(cita)">‚ùå</button>
          </div>
        </td>
      </ng-template>
    </tr>
  </tbody>
</table>

<!-- Modal de Confirmaci√≥n -->
<div *ngIf="showConfirmModal" class="modal-overlay">
  <div class="modal">
    <h3>Confirmar cita para {{ citaToConfirm?.paciente }}</h3>
    <p>Seleccione una opci√≥n:</p>
    <div class="modal-buttons">
      <!-- Bot√≥n Confirmar (SI) -->
      <button class="btn-confirm" (click)="handleConfirmOption('si')">
        Confirmar (SI)
      </button>

      <!-- Bot√≥n Denegar (NO) -->
      <button class="btn-deny" (click)="handleConfirmOption('no')">
        Denegar (NO)
      </button>

      <!-- Bot√≥n Pendiente -->
      <button class="btn-pending" (click)="handleConfirmOption('pendiente')">
        Pendiente
      </button>

      <!-- Bot√≥n Cancelar -->
      <button class="btn-cancel" (click)="handleConfirmOption('cancelar')">
        Cancelar
      </button>
    </div>
  </div>
</div>



  